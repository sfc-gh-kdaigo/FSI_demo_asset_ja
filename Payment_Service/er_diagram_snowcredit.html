<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ER図 - SnowCredit データモデル</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Hiragino Sans', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #00d9ff;
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }
        .subtitle {
            color: #8892b0;
            text-align: center;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        .mermaid {
            background: #ffffff;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        .legend {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            color: #ccd6f6;
        }
        .legend h3 {
            color: #00d9ff;
            margin-top: 0;
            font-size: 1rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 0.9rem;
        }
        .legend-symbol {
            font-family: monospace;
            background: rgba(0, 217, 255, 0.1);
            padding: 4px 10px;
            border-radius: 4px;
            margin-right: 12px;
            color: #00d9ff;
        }
        .note {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
            color: #ccd6f6;
            font-size: 0.85rem;
        }
        .export-btn {
            display: inline-block;
            background: linear-gradient(135deg, #00d9ff 0%, #0099cc 100%);
            color: #1a1a2e;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
            border: none;
            font-size: 0.9rem;
        }
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 217, 255, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ER図 - SnowCredit データモデル</h1>
        <p class="subtitle">クレジットカード業務向けデータウェアハウス</p>
        
        <div class="mermaid">
erDiagram
    DIM_CUSTOMER ||--o{ FACT_TRANSACTION : has
    DIM_MERCHANT ||--o{ FACT_TRANSACTION : has
    DIM_CAMPAIGN ||--o{ FACT_TRANSACTION : has

    DIM_CUSTOMER {
        number CUSTOMER_KEY PK
        string CUSTOMER_NUMBER
        string CARD_NUMBER
        string CUSTOMER_NAME
        string CUSTOMER_NAME_KANA
        date BIRTH_DATE
        string GENDER
        string POSTAL_CODE
        string ADDRESS
        string PHONE_NUMBER
        string EMAIL_ADDRESS
        string OCCUPATION
        number ANNUAL_INCOME
        string CARD_TYPE
        number ANNUAL_FEE
        number CREDIT_LIMIT
        date ISSUE_DATE
        date EXPIRY_DATE
        date JOIN_DATE
        timestamp LAST_UPDATED_AT
        boolean ACTIVE_FLAG
    }

    DIM_MERCHANT {
        number MERCHANT_KEY PK
        string MERCHANT_NUMBER
        string MERCHANT_NAME
        string INDUSTRY_CODE
        string INDUSTRY_NAME
        string COUNTRY_NAME
        string PREFECTURE
        string CITY
        boolean ONLINE_FLAG
        date CONTRACT_DATE
        timestamp LAST_UPDATED_AT
    }

    DIM_CAMPAIGN {
        number CAMPAIGN_KEY PK
        string CAMPAIGN_CODE
        string CAMPAIGN_NAME
        string CAMPAIGN_TYPE
        string TARGET_INDUSTRY_CODE
        number ADDITIONAL_REWARD_RATE
        date START_DATE
        date END_DATE
        boolean ACTIVE_FLAG
        timestamp LAST_UPDATED_AT
    }

    FACT_TRANSACTION {
        number TRANSACTION_KEY PK
        string TRANSACTION_NUMBER
        number CUSTOMER_KEY FK
        number MERCHANT_KEY FK
        number DATE_KEY
        number CAMPAIGN_KEY FK
        timestamp TRANSACTION_DATETIME
        number TRANSACTION_AMOUNT
        string CURRENCY_CODE
        string TRANSACTION_TYPE
        string APPROVAL_NUMBER
        string SETTLEMENT_STATUS
        number EARNED_POINTS
        number FEE_RATE
        number FEE_AMOUNT
        boolean OVERSEAS_FLAG
        number INSTALLMENT_COUNT
        string BONUS_TYPE
        timestamp CREATED_AT
        timestamp UPDATED_AT
    }

    OPERATION_DOCUMENT {
        string DOCUMENT_ID PK
        string TITLE
        string CONTENT
        string DOCUMENT_TYPE
        string DEPARTMENT
        timestamp CREATED_AT
        timestamp UPDATED_AT
        number VERSION
    }
        </div>

        <div class="legend">
            <h3>凡例・テーブル関係性</h3>
            <div class="legend-item">
                <span class="legend-symbol">||--o{</span>
                <span>1対多 (One to Many) の関係</span>
            </div>
            <div class="legend-item">
                <span class="legend-symbol">PK</span>
                <span>Primary Key（主キー）</span>
            </div>
            <div class="legend-item">
                <span class="legend-symbol">FK</span>
                <span>Foreign Key（外部キー）</span>
            </div>
            
            <table style="width: 100%; margin-top: 15px; border-collapse: collapse; color: #ccd6f6; font-size: 0.85rem;">
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <th style="text-align: left; padding: 8px; color: #00d9ff;">親テーブル</th>
                    <th style="text-align: left; padding: 8px; color: #00d9ff;">子テーブル</th>
                    <th style="text-align: left; padding: 8px; color: #00d9ff;">関係</th>
                    <th style="text-align: left; padding: 8px; color: #00d9ff;">結合キー</th>
                </tr>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 8px;">DIM_CUSTOMER</td>
                    <td style="padding: 8px;">FACT_TRANSACTION</td>
                    <td style="padding: 8px;">1:N</td>
                    <td style="padding: 8px;">CUSTOMER_KEY</td>
                </tr>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 8px;">DIM_MERCHANT</td>
                    <td style="padding: 8px;">FACT_TRANSACTION</td>
                    <td style="padding: 8px;">1:N</td>
                    <td style="padding: 8px;">MERCHANT_KEY</td>
                </tr>
                <tr>
                    <td style="padding: 8px;">DIM_CAMPAIGN</td>
                    <td style="padding: 8px;">FACT_TRANSACTION</td>
                    <td style="padding: 8px;">1:N</td>
                    <td style="padding: 8px;">CAMPAIGN_KEY</td>
                </tr>
            </table>

            <h3 style="margin-top: 20px;">テーブル概要</h3>
            <table style="width: 100%; border-collapse: collapse; color: #ccd6f6; font-size: 0.85rem;">
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <th style="text-align: left; padding: 8px; color: #00d9ff;">テーブル名</th>
                    <th style="text-align: left; padding: 8px; color: #00d9ff;">種別</th>
                    <th style="text-align: left; padding: 8px; color: #00d9ff;">説明</th>
                </tr>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 8px;">DIM_CUSTOMER</td>
                    <td style="padding: 8px;">ディメンション</td>
                    <td style="padding: 8px;">顧客マスタ：人口統計情報や財務情報を含む顧客情報</td>
                </tr>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 8px;">DIM_MERCHANT</td>
                    <td style="padding: 8px;">ディメンション</td>
                    <td style="padding: 8px;">加盟店マスタ：加盟店の識別情報と分類情報</td>
                </tr>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 8px;">DIM_CAMPAIGN</td>
                    <td style="padding: 8px;">ディメンション</td>
                    <td style="padding: 8px;">キャンペーンマスタ：マーケティングキャンペーン情報</td>
                </tr>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 8px;">FACT_TRANSACTION</td>
                    <td style="padding: 8px;">ファクト</td>
                    <td style="padding: 8px;">取引ファクト：金融取引の記録</td>
                </tr>
                <tr>
                    <td style="padding: 8px;">OPERATION_DOCUMENT</td>
                    <td style="padding: 8px;">マスタ</td>
                    <td style="padding: 8px;">運用ドキュメント：組織内で作成された文書</td>
                </tr>
            </table>
        </div>

        <div class="note">
            <strong>画像として保存する方法:</strong><br>
            ブラウザで右クリック → 「名前を付けて画像を保存」または、<br>
            スクリーンショットを撮影してください（Mac: Cmd+Shift+4）
        </div>

        <button class="export-btn" onclick="window.print()">PDF として印刷/保存</button>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            er: {
                diagramPadding: 20,
                layoutDirection: 'TB',
                minEntityWidth: 100,
                minEntityHeight: 75,
                entityPadding: 15,
                useMaxWidth: true
            }
        });
    </script>
</body>
</html>
